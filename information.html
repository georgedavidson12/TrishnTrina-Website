<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trish N Trina Performers Academy</title>
  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="Images/favicon_io/apple-touch-icon.png?v=2">
  <link rel="icon" type="image/png" sizes="16x16" href="Images/favicon_io/favicon-16x16.png?v=2">
  <link rel="icon" type="image/png" sizes="32x32" href="Images/favicon_io/favicon-32x32.png?v=2">
  <link rel="icon" type="image/png" sizes="48x48" href="Images/favicon_io/favicon-48x48.png?v=2">
  <link rel="icon" type="image/png" sizes="192x192" href="Images/favicon_io/android-chrome-192x192.png?v=2">
  <link rel="icon" type="image/png" sizes="512x512" href="Images/favicon_io/android-chrome-512x512.png?v=2">
  <link rel="manifest" href="Images/favicon_io/site.webmanifest?v=2">
  <link rel="shortcut icon" href="Images/favicon_io/favicon.ico?v=2" type="image/x-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

  <base href="/">

  <style>
    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background-color: #f2f2f2;
      color: #333;
      text-align: center;
    }
    *, *::before, *::after { box-sizing: border-box; }
    html, body { max-width: 100%; overflow-x: hidden; }

    header {
      background-color: #ffffff;
      padding: 0.5rem 0 0.1rem 0;
      width: 100%;
      position: relative;
    }

    .banner-logo {
      width: 100%;
      text-align: center;
      margin: 0;
      padding-bottom: 0;
    }

    .banner-logo img {
      display: block;
      margin: 0 auto;
      max-width: 320px;
      height: auto;
      max-height: 120px;
    }

    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1.5rem;
      padding: 0.5rem 1rem;
      background-color: #ffffff;
      border-bottom: 5px solid #FFEB3B;
    }

    nav a {
      text-decoration: none;
      color: #111;
      font-weight: 600;
      font-size: 1rem;
    }

    nav a:hover {
      color: #FFEB3B;
    }

    .section {
      padding: 1.0rem 1rem 3rem 1rem;
      background: #fff;
      margin-top: 0;
      border-top: 15px solid #f2f2f2; /* Light grey border above each section */
    }

    /* Remove border from the first section */
    .section:first-of-type {
      border-top: none;
    }

    .section h2 {
      color: #FFEB3B;
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .section h3 {
      color: #FFEB3B;
    }

    .section p {
      max-width: 1200px;
      margin: auto;
      font-size: 1.1rem;
      line-height: 1.6;
      padding: 0 0.5rem;
    }

    .cta-button {
      display: inline-block;
      margin-top: 1rem;
      background: #FFEB3B;
      color: #111;
      padding: 0.75rem 1.5rem;
      text-decoration: none;
      font-weight: 600;
      border-radius: 4px;
      border: none;                 /* remove default button borders */
      cursor: pointer;              /* pointer on both <a> and <button> */
      -webkit-appearance: none;     /* iOS Safari button reset */
      appearance: none;
      font-family: inherit;         /* ensure same font on iOS */
      font-size: 1rem;              /* unify default sizes */
      line-height: 1.2;             /* consistent vertical rhythm */
    }
    .cta-button:focus { outline: 2px solid #111; outline-offset: 2px; }

    .cta-button:hover {
      background: #e6c200;
      color: #fff;
    }

    footer {
      background: #111;
      color: #fff;
      text-align: center;
      padding: 2rem;
      margin-top: 15px;
      font-size: 0.9rem;
    }

    footer > div {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      gap: 2rem;
    }

    @media (max-width: 700px) {
      footer > div {
        flex-direction: column;
        align-items: stretch;
        gap: 2rem;
      }
      footer > div > div {
        padding: 0 !important;
        text-align: left !important;
        align-items: flex-start !important;
      }
    }

    footer a:hover {
      color: #FFEB3B !important;
    }
    .uniform-thumb {
      width: 220px;
      height: auto;
      border-radius: 6px;
      vertical-align: middle;
    }
    /* Downloads accordion styles */
    .dl-accordion {
      width: 100%;
      text-align: center;
      margin-top: .75rem;
      padding: .4rem 0;
      border: none;
      border-radius: 0;
      background: transparent;
      cursor: pointer;
      font-weight: 700;            
      font-size: 1.35rem;         
      color: #111;                
    }
    .dl-accordion::before {
      content: '▸';
      display: inline-block;
      margin-right: .5rem;
      transition: transform .2s;
    }
    .dl-accordion[aria-expanded="true"]::before {
      content: '▾';
    }
    .dl-accordion[aria-expanded="true"] {
      background: transparent;
    }
    .dl-panel {
      border: none;
      padding: .4rem 0 0;
      margin: 0 auto;
      border-radius: 0;
      background: transparent;
      text-align: center;
    }
    /* Downloads error message style */
    .dl-error {
      color: #b00020;                 /* strong red text */
      background: #fdecef;            /* soft red background */
      border: 1px solid #f5c2c7;      /* light red border */
      padding: .5rem .75rem;
      border-radius: 8px;
      max-width: 420px;
      margin: .25rem auto .5rem;     /* above the button */
      font-size: .95rem;
    }
    /* Red error state for password input */
    .dl-input-error {
      border-color: #b00020 !important;
      box-shadow: 0 0 0 3px rgba(176, 0, 32, 0.15);
    }
    @media (max-width: 480px) {
      #downloads { padding-left: 0.5rem !important; padding-right: 0.5rem !important; }
      #downloads-gate { width: 100% !important; max-width: 100% !important; }
      #dl-pw-form { width: 100% !important; max-width: 100% !important; margin-left: auto !important; margin-right: auto !important; }
      #dl-pw-form label { display: block; width: 100%; }
      #dl-pw-input {
        width: 100% !important;
        max-width: 100% !important;
        min-width: 0 !important;
        box-sizing: border-box !important;
        padding: .55rem .6rem !important;
        font-size: 16px !important; /* avoid iOS zoom */
      }
      .dl-error { max-width: 100% !important; width: 100% !important; }
      .cta-button { width: 100% !important; max-width: 100% !important; text-align: center; }
      .dl-panel ul { padding-left: 0 !important; margin-left: 0 !important; }
      .dl-panel li, .dl-panel a { word-break: break-word; overflow-wrap: anywhere; }
    }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-40XVRC4JZD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'G-40XVRC4JZD');
  </script>

</head>
<body>

  <header>
    <div class="banner-logo">
      <a href="index.html">
        <img src="Images/banner1.png" alt="Trish N Trina Logo">
      </a>
    </div>
  </header>

  <nav>
    <a href="about.html">About Us</a>
    <a href="teachers.html">Teachers</a>
    <a href="syllabus.html">Syllabus</a>
    <a href="timetable.html">Timetable</a>
    <a href="information.html">Information</a>
    <a href="testimonials.html">Testimonials</a>
    <a href="contact.html">Contact Us</a>

  </nav>
  <section class="section" id="uniform">
    <h2>Uniform</h2>
    <p>
      We’re introducing an academy uniform to help students feel part of the <strong>TNT family</strong>, look performance-ready in class, and keep everyone comfortable and safe while training.<br>
      We’re encouraging all students to transition to the academy uniform and aim for <strong>everyone to be in uniform by January</strong>.<br>
    </p>
    <p>
      All preschool and reception students are required to wear a lilac leotard and tutu.
    </p>
    <p>
      You can purchase the approved range (it makes an ideal Christmas present) directly from our supplier. Sizes are available for children and adults.
    </p>
    <div style="margin: 1.5rem 0;">
      <a class="cta-button" role="button" href="https://clicclothing.co.uk/collections/trish-trina-performers-academy" target="_blank" rel="noopener">Buy uniform here</a>
    </div>
  </section>

  <!-- Term Dates -->
  <section class="section" id="term-dates">
    <h2>Term Dates</h2>
    <p>Below are our term dates for the current academic year. Please note these may be subject to change.</p>
    <table style="max-width: 800px; margin: 1rem auto; width: 100%; border-collapse: collapse;">
      <tr>
        <th style="text-align:left; padding:0.5rem; border-bottom: 2px solid #ccc;">Term</th>
        <th style="text-align:right; padding:0.5rem; border-bottom: 2px solid #ccc;">Dates</th>
      </tr>
      <tr>
        <td style="padding:0.5rem;">Autumn 1</td>
        <td style="padding:0.5rem; text-align:right;">1 Sep 2025 – 25 Oct 2025</td>
      </tr>
      <tr>
        <td style="padding:0.5rem;">Autumn 2</td>
        <td style="padding:0.5rem; text-align:right;">3 Nov 2025 – 13 Dec 2025</td>
      </tr>
      <tr>
        <td style="padding:0.5rem;">Spring 1</td>
        <td style="padding:0.5rem; text-align:right;">5 Jan 2026 – 21 Feb 2026</td>
      </tr>
      <tr>
        <td style="padding:0.5rem;">Spring 2</td>
        <td style="padding:0.5rem; text-align:right;">2 Mar 2026 – 28 Mar 2026</td>
      </tr>
      <tr>
        <td style="padding:0.5rem;">Summer 1</td>
        <td style="padding:0.5rem; text-align:right;">13 Apr 2026 – 23 May 2026</td>
      </tr>
      <tr>
        <td style="padding:0.5rem;">Summer 2</td>
        <td style="padding:0.5rem; text-align:right;">1 Jun 2026 – 11 Jul 2026</td>
      </tr>
    </table>
  </section>

  <section class="section" id="chaperones">
    <h2>Chaperones</h2>
    <p>
      At our academy, we always require licensed chaperones to support and safeguard our students during shows and events. <br>
      If you are interested in helping, you will need to apply for a chaperone licence through your local county council. <br>
      We truly appreciate all offers of support — your help makes our performances possible.
    </p>
  </section>
  <section class="section" id="downloads">
    <h2>Downloads</h2>
    <noscript><p style="color:#b00020; max-width:720px; margin:0.5rem auto 0;">JavaScript is required to access downloads.</p></noscript>
    <p id="downloads-note">Enter the password to access the downloads.</p>

    <!-- Password Gate -->
    <div id="downloads-gate" style="padding:1rem 0; max-width:720px; margin:0 auto;">
      <form id="dl-pw-form" onsubmit="return false;" style="display:grid; gap:.75rem; max-width: 420px; margin: 0 auto;">
        <label>
          Password
          <input id="dl-pw-input" type="password"
                 autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false" inputmode="text" required
                 style="width:100%; padding:.6rem; border:1px solid #ccc; border-radius:8px;">
        </label>
        <div id="dl-pw-msg" class="dl-error" aria-live="polite" style="display:none;"></div>
        <div id="dl-diag" style="display:none; font-size:.85rem; color:#555; text-align:left; word-break:break-word;"></div>
        <div style="display:flex; align-items:center; justify-content:center;">
          <button id="dl-pw-btn" type="button" class="cta-button">Unlock Downloads</button>
        </div>
      </form>
    </div>

    <!-- Unlocked content (hidden by default) -->
    <div id="downloads-content" style="display:none; margin-top:1rem; max-width:800px; margin-left:auto; margin-right:auto;">

      <!-- Tuesday Accordion -->
      <button class="dl-accordion" aria-expanded="false" aria-controls="panel-tue">Tuesday</button>
      <div id="panel-tue" class="dl-panel" hidden>
        <ul style="list-style: none; padding: 0; margin: .5rem 0 0 0;">
          <!-- Grade 5 Zip: place a file at /downloads/Grade5_Music.zip -->
          <li style="margin:.5rem 0;">
            <a href="/downloads/Grade_5_music.zip" download>NCDTA Grade 5 Music</a>
            <span style="font-size:.9rem; color:#666; margin-left:.5rem;">(ZIP download)</span>
          </li>
          <li style="margin:.5rem 0;">
            <a href="/downloads/shim_sham_shimmy_g5.pdf" download>The Shim Sham Shimmy (Grade 5) Dance</a>
            <span style="font-size:.9rem; color:#666; margin-left:.5rem;">(PDF)</span>
          </li>
          <li style="margin:.5rem 0;">
            <a href="/downloads/shim_sham_shimmy_g5.mp3" download>The Shim Sham Shimmy (Grade 5) Music</a>
            <span style="font-size:.9rem; color:#666; margin-left:.5rem;">(mp3)</span>
          </li>
        </ul>
      </div>
    </div>
  </section>

  <footer style="background: #111; color: #fff; padding: 2rem; font-size: 0.9rem;">
    <div style="max-width: 1000px; margin: 0 auto; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 2rem;">
      <div style="flex: 1; min-width: 250px; margin-bottom: 1rem;">
        <p style="text-align: left;">
          <img src="Images/phone.png" alt="Phone" style="vertical-align: middle; height: 24px; margin-right: 8px;">
          <a href="tel:07761633157" style="color: #fff; text-decoration: none;">07761 633157</a>
        </p>
        <p style="text-align: left;">
          <img src="Images/email.png" alt="Email" style="vertical-align: middle; height: 24px; margin-right: 8px;">
          <a href="mailto:trishdanceacademy@gmail.com" style="color: #fff; text-decoration: none;">trishdanceacademy@gmail.com</a>
        </p>
        <div style="margin-top: 1rem; text-align: left;">
          <p style="margin: 0.5rem 0; font-size: 0.85rem;">
            <a href="https://www.facebook.com/trishntrina" style="color: #fff; text-decoration: none; display: inline-flex; align-items: center; margin-right: 16px;">
              <img src="Images/facebook.png" alt="Facebook" style="height: 24px; margin-right: 6px;">
              Facebook
            </a>
            <a href="https://www.instagram.com/tntperformersacademy/" style="color: #fff; text-decoration: none; display: inline-flex; align-items: center;">
              <img src="Images/instagram.png" alt="Instagram" style="height: 24px; margin-right: 6px;">
              Instagram
            </a>
          </p>
        </div>
      </div>
      <div style="flex: 1; min-width: 250px; display: flex; flex-direction: column; justify-content: center; align-items: flex-end; text-align: right; margin-bottom: 1rem;">
        <p>&copy; 2025 Trish N Trina Performers Academy</p>
        <p>Website designed by George Davidson</p>
      </div>
    </div>
  </footer>

</body>
<script>
  const slides = document.querySelectorAll('.slide');
  const dots = document.querySelectorAll('.carousel-dot');
  let current = 0;

  function showSlide(index) {
    if (!slides.length) return; // no carousel on this page
    const next = ((index % slides.length) + slides.length) % slides.length; // clamp & wrap
    if (slides[current]) slides[current].classList.remove('active');
    if (dots.length && dots[current]) dots[current].classList.remove('active');
    current = next;
    slides[current].classList.add('active');
    if (dots.length && dots[current]) dots[current].classList.add('active');
  }

  // Dot hover controls (safe if no dots)
  if (dots.length) {
    dots.forEach(dot => {
      dot.addEventListener('mouseenter', () => {
        const index = parseInt(dot.getAttribute('data-index'));
        if (!Number.isNaN(index)) showSlide(index);
        resetInterval();
      });
    });
  }

  let intervalId = null;
  if (slides.length > 1) {
    intervalId = setInterval(() => {
      showSlide(current + 1);
    }, 5000);
  }

  function resetInterval() {
    if (intervalId) {
      clearInterval(intervalId);
      intervalId = setInterval(() => showSlide(current + 1), 5000);
    }
  }

  function showPreviousSlide() { showSlide(current - 1); resetInterval(); }
  function showNextSlide() { showSlide(current + 1); resetInterval(); }
</script>
<script>
  // ===== Password Gate (single shared password) =====
  // We store only the SHA-256 hash of the password here, not the plaintext.
  // sha256("washington") in hex:
  const DL_PASSWORD_HASH_HEX = "1865e4f9be9639fc76d7d4da8ee25eaa7421f6837accb67516937e69469ea7e4";

  const DL_KEY = "tnt_downloads_auth_v1"; // storage key
  const dlGate = document.getElementById("downloads-gate");
  const dlArea = document.getElementById("downloads-content");
  const dlForm = document.getElementById("dl-pw-form");
  const dlInput = document.getElementById("dl-pw-input");
  const dlMsg = document.getElementById("dl-pw-msg");
  // Do not persist access between reloads; clear any previous storage
  try { localStorage.removeItem(DL_KEY); sessionStorage.removeItem(DL_KEY); } catch(e) {}

  // Utility: hex <-> ArrayBuffer
  function hexToBytes(hex) {
    const bytes = new Uint8Array(hex.length / 2);
    for (let i = 0; i < bytes.length; i++) {
      bytes[i] = parseInt(hex.substr(i * 2, 2), 16);
    }
    return bytes;
  }
  function bytesToHex(bytes) {
    return Array.from(new Uint8Array(bytes))
      .map(b => b.toString(16).padStart(2, "0")).join("");
  }

// WebCrypto SHA-256 hasher (async)
async function sha256Hex(text) {
  const enc = new TextEncoder();
  const data = enc.encode(text);
  const digest = await crypto.subtle.digest("SHA-256", data);
  return bytesToHex(digest);
}

// Pure JS SHA-256 implementation (used for all hashing)
function sha256HexJS(message) {
  function toBytes(str) {
    const utf8 = unescape(encodeURIComponent(str));
    const bytes = new Uint8Array(utf8.length);
    for (let i = 0; i < utf8.length; i++) bytes[i] = utf8.charCodeAt(i);
    return bytes;
  }
  function rotr(n, x) { return (x >>> n) | (x << (32 - n)); }
  function ch(x, y, z) { return (x & y) ^ (~x & z); }
  function maj(x, y, z) { return (x & y) ^ (x & z) ^ (y & z); }
  function s0(x) { return rotr(7, x) ^ rotr(18, x) ^ (x >>> 3); }
  function s1(x) { return rotr(17, x) ^ rotr(19, x) ^ (x >>> 10); }
  function S0(x) { return rotr(2, x) ^ rotr(13, x) ^ rotr(22, x); }
  function S1(x) { return rotr(6, x) ^ rotr(11, x) ^ rotr(25); }

  const K = new Uint32Array([
    0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,
    0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,
    0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,
    0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,
    0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,
    0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,
    0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,
    0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2
  ]);

  const bytes = toBytes(message);
  const bitLen = bytes.length * 8;

  const withOne = new Uint8Array(bytes.length + 1); withOne.set(bytes); withOne[bytes.length] = 0x80;
  const padLen = (56 - (withOne.length % 64) + 64) % 64;
  const padded = new Uint8Array(withOne.length + padLen + 8); padded.set(withOne);
  for (let i = 0; i < 8; i++) padded[padded.length - 1 - i] = (bitLen >>> (i * 8)) & 0xff;

  let h0=0x6a09e667,h1=0xbb67ae85,h2=0x3c6ef372,h3=0xa54ff53a,h4=0x510e527f,h5=0x9b05688c,h6=0x1f83d9ab,h7=0x5be0cd19;
  const w = new Uint32Array(64);

  for (let i = 0; i < padded.length; i += 64) {
    for (let t = 0; t < 16; t++) {
      const j = i + t*4;
      w[t] = ((padded[j] << 24) | (padded[j+1] << 16) | (padded[j+2] << 8) | (padded[j+3])) >>> 0;
    }
    for (let t = 16; t < 64; t++) {
      w[t] = (((w[t-16] + s0(w[t-15])) >>> 0) + ((w[t-7] + s1(w[t-2])) >>> 0)) >>> 0;
    }

    let a=h0,b=h1,c=h2,d=h3,e=h4,f=h5,g=h6,h=h7;
    for (let t = 0; t < 64; t++) {
      const T1 = (((((h + S1(e)) >>> 0) + (ch(e,f,g) >>> 0)) >>> 0) + ((K[t] + w[t]) >>> 0)) >>> 0;
      const T2 = (S0(a) + maj(a,b,c)) >>> 0;
      h = g; g = f; f = e; e = (d + T1) >>> 0; d = c; c = b; b = a; a = (T1 + T2) >>> 0;
    }

    h0 = (h0 + a) >>> 0; h1 = (h1 + b) >>> 0; h2 = (h2 + c) >>> 0; h3 = (h3 + d) >>> 0;
    h4 = (h4 + e) >>> 0; h5 = (h5 + f) >>> 0; h6 = (h6 + g) >>> 0; h7 = (h7 + h) >>> 0;
  }

  function hex32(x) { return (x >>> 0).toString(16).padStart(8, '0'); }
  return hex32(h0)+hex32(h1)+hex32(h2)+hex32(h3)+hex32(h4)+hex32(h5)+hex32(h6)+hex32(h7);
}

// Prefer WebCrypto in secure contexts (desktop), fallback to pure JS
async function sha256HexCompat(text) {
  try {
    if (window.crypto && window.crypto.subtle) return await sha256Hex(text);
  } catch (_) {}
  return sha256HexJS(text);
}

function normalisePwInput(s) {
  if (s == null) return "";
  let t = String(s);
  try { if (t.normalize) t = t.normalize('NFKC'); } catch(e) {}
  // Remove zero-width chars and non-breaking spaces
  t = t.replace(/[\u200B-\u200D\uFEFF\u00A0]/g, '');
  return t.trim().toLowerCase();
}

function prepareForHashRaw(s) {
  if (s == null) return "";
  let t = String(s);
  try { if (t.normalize) t = t.normalize('NFKC'); } catch(e) {}
  t = t.replace(/[\u200B-\u200D\uFEFF\u00A0]/g, '');
  t = t.replace(/[\r\n]+/g, '');
  return t; // keep case and spaces exactly
}

  function showDownloadsArea() {
    if (dlArea) dlArea.style.display = "block";
    if (dlGate) dlGate.style.display = "none";
    sanitizeDownloadLinks();
  }

  // Fix common mistaken extensions like .zip.html, .pdf.html, etc., and ensure download attr
  function sanitizeDownloadLinks() {
    if (!dlArea) return;
    const anchors = dlArea.querySelectorAll('a[href]');
    anchors.forEach(a => {
      try {
        let href = a.getAttribute('href');
        if (!href) return;
        // Only adjust client-side for known file types
        const fixes = ['.zip.html', '.pdf.html', '.docx.html', '.pptx.html'];
        for (const suffix of fixes) {
          if (href.endsWith(suffix)) {
            href = href.slice(0, -5); // remove trailing '.html'
            a.setAttribute('href', href);
            break;
          }
        }
        // Ensure browser treats link as download
        if (!a.hasAttribute('download')) a.setAttribute('download', '');
        // For safety, add rel to any target
        if (a.getAttribute('target') === '_blank') {
          const rel = a.getAttribute('rel') || '';
          if (!/noopener|noreferrer/.test(rel)) a.setAttribute('rel', (rel + ' noopener noreferrer').trim());
        }
      } catch (e) { /* noop */ }
    });
  }

  // Allow-list of acceptable hashes (canonical + common mobile variants)
  const ALLOWED_HASHES = new Set([DL_PASSWORD_HASH_HEX]);
  (async function preloadVariantHashes(){
    try {
      const variants = [
        'washington',        // exact
        'Washington',        // auto-capitalised first letter
        'washington ',       // trailing ASCII space
        'washington\u00A0'   // trailing NBSP
      ];
      for (const v of variants) {
        const h = await sha256HexCompat(prepareForHashRaw(v));
        ALLOWED_HASHES.add(h);
      }
    } catch (e) { console.warn('Variant preload failed', e); }
  })();

  const DEBUG = new URLSearchParams(location.search).has('debug');
  const dlDiag = document.getElementById('dl-diag');
  if (DEBUG && dlDiag) dlDiag.style.display = 'block';
  function codePointsHex(str){
    const arr = [];
    for (const ch of str) arr.push(ch.codePointAt(0).toString(16).padStart(2,'0'));
    return arr.join(' ');
  }

  async function validatePassword(ev) {
    if (ev && ev.preventDefault) ev.preventDefault();
    dlMsg.textContent = "";
    dlMsg.style.display = 'none';
    dlInput.classList.remove('dl-input-error');
    try {
      const rawInput = prepareForHashRaw(dlInput.value);
      const strictInput = normalisePwInput(dlInput.value);
      const [rawHash, strictHash] = await Promise.all([
        sha256HexCompat(rawInput),
        sha256HexCompat(strictInput)
      ]);

      if (DEBUG && dlDiag) {
        dlDiag.textContent = `DEBUG (temporary)\nlen=${rawInput.length}\ncodepoints=${codePointsHex(rawInput)}\nrawHash=${rawHash}\nstrictHash=${strictHash}`;
      }

      if (ALLOWED_HASHES.has(rawHash) || ALLOWED_HASHES.has(strictHash)) {
        showDownloadsArea();
      } else {
        dlInput.classList.add('dl-input-error');
        dlMsg.textContent = "Incorrect password. Please try again.";
        dlMsg.style.display = 'block';
      }
    } catch (e) {
      console.error(e);
      dlMsg.textContent = "Unable to verify password. Please try again.";
      dlMsg.style.display = 'block';
    }
    return false;
  }

  if (dlForm) dlForm.addEventListener('submit', validatePassword);
  const dlBtn = document.getElementById('dl-pw-btn');
  if (dlBtn) dlBtn.addEventListener('click', validatePassword);
  if (dlInput) dlInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') validatePassword(e);
  });

</script>
<script>
  // Lightweight accordion toggling for Downloads
  for (const btn of document.querySelectorAll('.dl-accordion')) {
    btn.addEventListener('click', () => {
      const panelId = btn.getAttribute('aria-controls');
      const panel = document.getElementById(panelId);
      const open = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!open));
      if (panel) {
        if (open) {
          panel.setAttribute('hidden', '');
        } else {
          panel.removeAttribute('hidden');
        }
      }
    });
  }
</script>
</html>
